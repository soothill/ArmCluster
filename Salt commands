#!/bin/bash
salt '*' cmd.run 'setpci -s 0001:00.0 68.w=5950'
#salt '*' cmd.run 'setpci -s 5b:00.1 68.w=5950'
#salt '*' cmd.run 'ip link set bond0 mtu 9000'
#salt '*' cmd.run 'for j in `cat /sys/class/net/bond0/bonding/slaves`;do LOCAL_CPUS=`cat /sys/class/net/$j/device/local_cpus`;echo $LOCAL_CPUS > /sys/class/net/$j/queues/rx-0/rps_cpus;done'
salt '*' cmd.run 'ethtool -G eth0 rx 8192 tx 8192'
salt '*' cmd.run 'sysctl -w net.ipv4.tcp_sack=0'
salt '*' cmd.run 'sysctl -w net.core.rmem_max=2147483647'
salt '*' cmd.run 'sysctl -w net.core.wmem_max=2147483647'
salt '*' cmd.run 'sysctl -w net.core.somaxconn=2048'
salt '*' cmd.run 'sysctl -w net.ipv4.tcp_low_latency=1'
salt '*' cmd.run 'sysctl -w net.ipv4.tcp_rmem="10240 87380 2147483647"'
salt '*' cmd.run 'sysctl -w net.ipv4.tcp_wmem="10240 87380 2147483647"'
salt '*' cmd.run 'sysctl -w net.ipv4.tcp_timestamps=0'
salt '*' cmd.run 'sysctl -w net.core.netdev_max_backlog=250000'
#salt '*' cmd.run 'mlnx_tune -p HIGH_THROUGHPUT'
salt '*' cmd.run 'echo never > /sys/kernel/mm/transparent_hugepage/enabled'
salt '*' cmd.run 'sysctl -w vm.min_free_kbytes=1000000'
